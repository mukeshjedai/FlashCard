@model List<MyMVCApp.Controllers.HomeController.QuestionModel>

<!DOCTYPE html>
<html>
<head>
    <title>MCQ Quiz</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h1 class="mb-4">Multiple Choice Questions</h1>
    <form id="quizForm">
        @foreach (var question in Model)
        {
        <div class="mb-4">
            <h4>@question.Question</h4>
            @foreach (var option in question.Options.SelectMany(o => o.Split(',')))
            {
            <div class="form-check">
                <input class="form-check-input" type="radio" name="question-@question.Id" id="option-@question.Id-@option.GetHashCode()" value="@option.Trim()">
                <label class="form-check-label" for="option-@question.Id-@option.GetHashCode()">
                    @option.Trim()
                </label>
            </div>
            }
        </div>
        }
        <button type="button" id="submitQuiz" class="btn btn-primary">Submit</button>
    </form>

    <div id="result" class="mt-4" style="display:none;">
        <h3>Result</h3>
        <p id="resultText"></p>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $('#submitQuiz').on('click', function () {
            const answers = {};
            $('input[type="radio"]:checked').each(function () {
                const questionId = $(this).attr('name').split('-')[1];
                const selectedOption = $(this).val();
                answers[questionId] = selectedOption;
            });

            $.ajax({
                url: '/Home/SubmitAnswer',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(answers),
                success: function (response) {
                    let correctAnswers = 0;
                    let totalQuestions = Object.keys(answers).length;

                    $.each(response, function (id, isCorrect) {
                        if (isCorrect) {
                            correctAnswers++;
                        }
                    });

                    $('#resultText').text(`You got ${correctAnswers} out of ${totalQuestions} correct.`);
                    $('#result').show();
                },
                error: function () {
                    alert('An error occurred while submitting the quiz.');
                }
            });
        });
    });
</script>
</body>
</html>
